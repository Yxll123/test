// pages/yiguo/drink/drink.js
Page({

  /**
   * 页面的初始数据
   */
  data: {
    classify: [
      {
        "id": "1",
        "name": "热销",
        "isSlt": "0",
        "goodsItem": [
          {
            "id": "003x001",
            "goodsName": "爱必浓鸟屋音响灯爱必浓鸟屋音响灯",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓mini智能音响爱必浓鸟屋音响灯",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x003",
            "goodsName": "爱必浓小鸟夜灯",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x004",
            "goodsName": "爱必浓无线充电台灯",
            "imageUrl": "",
            "isSlt": "0"
          }
        ]
      },
      {
        "id": "2",
        "name": "香薰生活",
        "isSlt": "0",
        "goodsItem": [
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          }
        ]
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": [
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          }
        ]
      },
      {
        "id": "4",
        "name": "个人随身",
        "isSlt": "0",
        "goodsItem": [
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          }
        ]
      },
      {
        "id": "5",
        "name": "收纳储藏",
        "isSlt": "0",
        "goodsItem": [
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "004x001",
            "goodsName": "爱必浓香薰音响机",
            "imageUrl": "",
            "isSlt": "0"
          },
          {
            "id": "003x002",
            "goodsName": "爱必浓甜橙味5ML精油",
            "imageUrl": "",
            "isSlt": "0"
          }
        ]
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      },
      {
        "id": "3",
        "name": "居家生活",
        "isSlt": "0",
        "goodsItem": []
      }
    ],
    currentViewIdx:0//
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    console.log(options);
    wx.setNavigationBarTitle({
      title: options.name,
      success: function (res) { },
      fail: function (res) { },
      complete: function (res) { },
    })
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {
    var that = this;
    //创建节点选择器
    var query = wx.createSelectorQuery();
    //选择id
    for (var i in this.data.classify) {
      query.select('#view_' + i).boundingClientRect();
    }
    query.exec(function (res) {
      //res就是 所有标签为mjltest的元素的信息 的数组
      console.log(res);
      //取高度
      console.log(res[0].height);
      if (res.length > 0) {
        var firstH = res[0].height;
        let classifyGodds = [];
        for (var i = 0; i < res.length; i++) {
          if (i != 0) {
            firstH += res[i].height;
          }
          classifyGodds.push(firstH);
        }
        console.log(classifyGodds);
        that.setData({
          classifyGodds: classifyGodds
        })
      }
    });

    this.modalFood = this.selectComponent("#modalFood");
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  },
  chooseCat: function (e) {
    var idx = e.currentTarget.dataset.idx;
    this.data.clickTrigger = true;
    console.log(idx);
    this.setData({
      currentViewIdx: idx,
      scrollIntoView: idx
    })
  },
  bindscroll: function (e) {
    if (this.data.clickTrigger) {
      console.log("点击左侧，触发滚动");
      this.data.clickTrigger = false;
      return;
    }
    var length = e.detail.scrollTop;
    var classifyGodds = this.data.classifyGodds;
    for (var i in classifyGodds) {
      if ((length + 50) < classifyGodds[i]) {
        this.setData({
          currentViewIdx: i
        })
        console.log(length + " " + i + " " + classifyGodds[i]);
        return;
      }
    }
  },
  showModalFood() {
    this.modalFood._modalShow();
  }
})